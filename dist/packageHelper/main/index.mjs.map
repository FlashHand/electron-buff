{"version":3,"sources":["../../../src/packageHelper/main/package.helper.ts"],"names":[],"mappings":";;;;;AAKA,IAAM,oBAAA,GAAuB,6BAAA;AAE7B,IAAM,cAAA,GAAwC;AAAA,EAC5C,MAAA;AAAA,EACA,SAAA;AAAA,EACA,aAAA;AAAA,EACA,aAAA;AAAA,EACA,YAAA;AAAA,EACA,QAAA;AAAA,EACA,SAAA;AAAA,EACA;AACF,CAAA;AAEA,IAAM,QAAA,GAA2C;AAAA,EAC/C,IAAA,EAAM,EAAA;AAAA,EACN,OAAA,EAAS,EAAA;AAAA,EACT,WAAA,EAAa,CAAA;AAAA,EACb,WAAA,EAAa,EAAA;AAAA,EACb,UAAA,EAAY,EAAA;AAAA,EACZ,MAAA,EAAQ,EAAA;AAAA,EACR,OAAA,EAAS,EAAA;AAAA,EACT,QAAA,EAAU;AACZ,CAAA;AAEA,IAAM,oBAAN,MAAwB;AAAA,EAAxB,WAAA,GAAA;AACE,IAAA,IAAA,CAAQ,MAAA,GAA6B,IAAA;AAAA,EAAA;AAAA,EAE7B,WAAW,GAAA,EAAuC;AACxD,IAAA,MAAM,SAA8B,EAAC;AACrC,IAAA,KAAA,MAAW,OAAO,cAAA,EAAgB;AAChC,MAAA,MAAA,CAAO,GAAG,CAAA,GAAI,GAAA,CAAI,GAAG,CAAA,IAAK,SAAS,GAAG,CAAA;AAAA,IACxC;AACA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,cAAA,GAAuC;AAC3C,IAAA,IAAI,IAAA,CAAK,MAAA,EAAQ,OAAO,IAAA,CAAK,MAAA;AAE7B,IAAA,MAAM,OAAA,GAAU,IAAI,UAAA,EAAW;AAC/B,IAAA,MAAM,WAAA,GAAc,IAAA,CAAK,OAAA,EAAS,cAAc,CAAA;AAChD,IAAA,MAAM,MAAM,IAAA,CAAK,KAAA,CAAM,MAAM,QAAA,CAAS,WAAA,EAAa,OAAO,CAAC,CAAA;AAC3D,IAAA,IAAA,CAAK,MAAA,GAAS,IAAA,CAAK,UAAA,CAAW,GAAG,CAAA;AACjC,IAAA,OAAO,IAAA,CAAK,MAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,IAAA,GAAa;AACX,IAAA,OAAA,CAAQ,MAAA,CAAO,sBAAsB,YAAY;AAC/C,MAAA,OAAO,MAAM,KAAK,cAAA,EAAe;AAAA,IACnC,CAAC,CAAA;AAAA,EACH;AACF,CAAA;AAEO,IAAM,iBAAA,GAAoB,IAAI,iBAAA","file":"index.mjs","sourcesContent":["import { app, ipcMain } from 'electron';\nimport { join } from 'path';\nimport { readFile } from 'fs/promises';\nimport type { PackageInfo } from '../shared/packageHelper.type';\n\nconst IPC_GET_PACKAGE_INFO = '__buff_pkg_getPackageInfo__';\n\nconst ALLOWED_FIELDS: (keyof PackageInfo)[] = [\n  'name',\n  'version',\n  'versionCode',\n  'description',\n  'repository',\n  'author',\n  'license',\n  'homepage',\n];\n\nconst DEFAULTS: Record<keyof PackageInfo, any> = {\n  name: '',\n  version: '',\n  versionCode: 0,\n  description: '',\n  repository: '',\n  author: '',\n  license: '',\n  homepage: '',\n};\n\nclass PackageMainHelper {\n  private cached: PackageInfo | null = null;\n\n  private pickFields(raw: Record<string, any>): PackageInfo {\n    const result: Record<string, any> = {};\n    for (const key of ALLOWED_FIELDS) {\n      result[key] = raw[key] ?? DEFAULTS[key];\n    }\n    return result as PackageInfo;\n  }\n\n  /**\n   * Read package.json from app.getAppPath(), cache after first read.\n   * Returns only the allowed fields.\n   */\n  async getPackageInfo(): Promise<PackageInfo> {\n    if (this.cached) return this.cached;\n\n    const appPath = app.getAppPath();\n    const packagePath = join(appPath, 'package.json');\n    const raw = JSON.parse(await readFile(packagePath, 'utf-8'));\n    this.cached = this.pickFields(raw);\n    return this.cached;\n  }\n\n  /**\n   * Register IPC listener so renderer/preload processes can request package info.\n   * Call this in the main process during initialization.\n   */\n  init(): void {\n    ipcMain.handle(IPC_GET_PACKAGE_INFO, async () => {\n      return await this.getPackageInfo();\n    });\n  }\n}\n\nexport const packageMainHelper = new PackageMainHelper();\n"]}